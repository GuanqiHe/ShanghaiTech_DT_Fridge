var LPAPI=function(){function LPAPI(){this.init()}var defaultLineWidth=.3;var defaultCornerRadius=1.5;LPAPI.prototype.init=function(){if(!this.dtPrinter)this.dtPrinter=document.getElementById("dtPrinter");if(this.dtPrinter)return;try{var div=document.createElement("div");div.style.display="none";div.innerHTML='<object id="dtPrinter" classid="clsid:9D846E42-C3EF-4A5D-9805-A269CE7AA470"></object>';if(document.body)document.body.appendChild(div);else document.appendChild(div);this.dtPrinter=document.getElementById("dtPrinter");try{this.dtPrinter.GetAllPrinters(true)}catch(e){alert("未检测到标签打印机插件，请注册插件（不支持非IE浏览器）！\n"+e.toString())}}catch(e){}};LPAPI.prototype.getItemOrientation=function(){return this.dtPrinter.ItemOrientation};LPAPI.prototype.setItemOrientation=function(nNewValue){this.dtPrinter.ItemOrientation=nNewValue};LPAPI.prototype.getItemHorizontalAlignment=function(){return this.dtPrinter.ItemHorizontalAlignment};LPAPI.prototype.setItemHorizontalAlignment=function(nNewValue){this.dtPrinter.ItemHorizontalAlignment=nNewValue};LPAPI.prototype.getItemVerticalAlignment=function(){return this.dtPrinter.ItemVerticalAlignment};LPAPI.prototype.setItemVerticalAlignment=function(nNewValue){this.dtPrinter.ItemVerticalAlignment=nNewValue};LPAPI.prototype.openPrinter=function(printerName){return this.dtPrinter.OpenPrinter(printerName)===0};LPAPI.prototype.getPrinterName=function(){return this.dtPrinter.GetPrinterName()};LPAPI.prototype.isPrinterOpened=function(){return this.dtPrinter.IsPrinterOpened()===0};LPAPI.prototype.isPrinterOnline=function(){return this.dtPrinter.IsPrinterOnline()===0};LPAPI.prototype.closePrinter=function(){this.dtPrinter.ClosePrinter()};LPAPI.prototype.getSupportedPrinters=function(onlyOnline){onlyOnline=onlyOnline===undefined?false:onlyOnline;this.init();try{return this.dtPrinter.GetSupportedPrinters(onlyOnline)}catch(e){}return false};LPAPI.prototype.getAllPrinters=function(onlyOnline){onlyOnline=onlyOnline===undefined?false:onlyOnline;this.init();try{return this.dtPrinter.GetAllPrinters(onlyOnline)}catch(e){}return false};LPAPI.prototype.ParamID={GapType:1,PrintDarkness:2,PrintSpeed:3};LPAPI.prototype.GapType={Unset:255,None:0,Hole:1,Gap:2,Black:3};LPAPI.prototype.getParam=function(paramID){return this.dtPrinter.GetParam(paramID)};LPAPI.prototype.setParam=function(paramID,paramValue){return this.dtPrinter.SetParam(paramID,paramValue)};LPAPI.prototype.getGapType=function(){return this.dtPrinter.getParam(this.ParamID.GapType)};LPAPI.prototype.setGapType=function(value){value=parseInt(value);if(isNaN(value))return;return this.setParam(this.ParamID.GapType,value)===0};LPAPI.prototype.getPrintSpeed=function(){return this.getParam(this.ParamID.PrintSpeed)};LPAPI.prototype.setPrintSpeed=function(value){value=parseInt(value);if(isNaN(value))return;return this.setParam(this.ParamID.PrintSpeed,value)===0};LPAPI.prototype.getPrintDarkness=function(){return this.getParam(this.ParamID.PrintDarkness)};LPAPI.prototype.setPrintDarkness=function(value){value=parseInt(value);if(isNaN(value))return;return this.setParam(this.ParamID.PrintDarkness,value)===0};LPAPI.prototype.startJob=function(width,height,orientation,jobName){orientation=typeof orientation!=="number"?0:orientation;return this.dtPrinter.StartJob(width*100,height*100,30,orientation,1,jobName||"")===0};LPAPI.prototype.abortJob=function(){this.dtPrinter.AbortJob()};LPAPI.prototype.commitJob=function(){return this.dtPrinter.CommitJob()===0};LPAPI.prototype.startPage=function(){return this.dtPrinter.StartPage()===0};LPAPI.prototype.endPage=function(){this.dtPrinter.EndPage()};LPAPI.prototype.isWin10=function(){return navigator.userAgent.match(/windows\s*nt\s*(10\.[0-9]*)/i)};LPAPI.prototype.drawText=function(text,x,y,width,height,fontName,fontHeight,fontStyle){fontHeight=fontHeight||height;fontStyle=this.isWin10()?0:typeof fontStyle==="number"?fontStyle:0;return this.dtPrinter.DrawText(text,x*100,y*100,width*100,height*100,fontName||"黑体",fontHeight*100,fontStyle)===0};LPAPI.prototype.draw1DBarcode=function(text,type,x,y,width,height,textHeight){if(type<=20||type>60)type=60;return this.dtPrinter.Draw1DBarcode(text,type,x*100,y*100,width*100,height*100,(textHeight||0)*100)===0};LPAPI.prototype.draw2DQRCode=function(text,x,y,width,height){height=height||width;return this.dtPrinter.Draw2DQRCode(text,x*100,y*100,width*100,height*100)===0};LPAPI.prototype.draw2DPdf417=function(text,x,y,width,height){return this.dtPrinter.Draw2DPdf417(text,x*100,y*100,width*100,height*100)===0};LPAPI.prototype.drawRectangle=function(x,y,width,height,lineWidth){lineWidth=lineWidth||defaultLineWidth;return this.dtPrinter.DrawRectangle(x*100,y*100,width*100,height*100,lineWidth*100)===0};LPAPI.prototype.fillRectangle=function(x,y,width,height){return this.dtPrinter.FillRectangle(x*100,y*100,width*100,height*100)===0};LPAPI.prototype.drawRoundRectangle=function(x,y,width,height,cornerWidth,cornerHeight,lineWidth){cornerWidth=typeof cornerWidth==="number"?cornerWidth:defaultCornerRadius;cornerHeight=typeof cornerHeight==="number"?cornerHeight:cornerWidth;lineWidth=lineWidth||defaultLineWidth;return this.dtPrinter.DrawRoundRectangle(x*100,y*100,width*100,height*100,cornerWidth*100,cornerHeight*100,lineWidth*100)===0};LPAPI.prototype.fillRoundRectangle=function(x,y,width,height,cornerWidth,cornerHeight){cornerWidth=typeof cornerWidth==="number"?cornerWidth:defaultCornerRadius;cornerHeight=typeof cornerHeight==="number"?cornerHeight:cornerWidth;return this.dtPrinter.FillRoundRectangle(x*100,y*100,width*100,height*100,cornerWidth*100,cornerHeight*100)===0};LPAPI.prototype.drawEllipse=function(x,y,width,height,lineWidth){lineWidth=lineWidth||defaultLineWidth;return this.dtPrinter.DrawEllipse(x*100,y*100,width*100,height*100,lineWidth*100)===0};LPAPI.prototype.fillEllipse=function(x,y,width,height){return this.dtPrinter.FillEllipse(x*100,y*100,width*100,height*100)===0};LPAPI.prototype.drawLine=function(x1,y1,x2,y2,lineWidth){lineWidth=lineWidth||defaultLineWidth;return this.dtPrinter.DrawLine(x1*100,y1*100,x2*100,y2*100,lineWidth*100)===0};LPAPI.prototype.drawDashLine2=function(x1,y1,x2,y2,lineWidth,dashLen1,dashLen2){lineWidth=lineWidth||defaultLineWidth;dashLen1=dashLen1||.5;dashLen2=dashLen2||dashLen1*.5;return this.dtPrinter.DrawDashLine2(x1*100,y1*100,x2*100,y2*100,lineWidth*100,dashLen1*100,dashLen2*100)===0};LPAPI.prototype.drawDashLine4=function(x1,y1,x2,y2,lineWidth,dashLen1,dashLen2,dashLen3,dashLen4){lineWidth=lineWidth||defaultLineWidth;dashLen1=dashLen1||.5;dashLen2=dashLen2||dashLen1*.5;dashLen3=dashLen3||dashLen1;dashLen4=dashLen4||dashLen2;return this.dtPrinter.DrawDashLine4(x1*100,y1*100,x2*100,y2*100,lineWidth*100,dashLen1*100,dashLen2*100,dashLen3*100,dashLen4*100)===0};LPAPI.prototype.drawImage=function(imageFile,x,y,width,height,threshold){return this.dtPrinter.DrawImage(imageFile,x*100,y*100,width*100,height*100,threshold||192)===0};return LPAPI}();